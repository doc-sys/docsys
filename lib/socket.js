"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var sio = require('socket.io');

var io = new sio({
  serveClient: false,
  path: '/socket.io'
});
io.origins(function (o, cb) {
  cb(null, true);
});
io.use(function (socket, next) {
  var token = socket.handshake.query.token;

  if (token) {
    socket.token = token;
    return next();
  }

  return next(new Error('Auth not valid'));
});
var notification_channel = io.of('/notifications');
var message_channel = io.of('/message');
io.on('connection', function (socket) {//update socket id with username and online status
});
message_channel.on('connection', function (socket) {
  console.log(socket.token); //Handle convo join

  socket.on('join', function (data) {
    socket.join(data.convoId);
  }); //Handle new message

  socket.on('message', function (data) {
    //save in db
    //emit to other recps
    socket.to(data.convoId).emit(data.message);
  }); //Leave conversation

  socket.on('leave', function (data) {
    socket.leave(data.convoId);
  });
});
var _default = io;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zb2NrZXQudHMiXSwibmFtZXMiOlsic2lvIiwicmVxdWlyZSIsImlvIiwic2VydmVDbGllbnQiLCJwYXRoIiwib3JpZ2lucyIsIm8iLCJjYiIsInVzZSIsInNvY2tldCIsIm5leHQiLCJ0b2tlbiIsImhhbmRzaGFrZSIsInF1ZXJ5IiwiRXJyb3IiLCJub3RpZmljYXRpb25fY2hhbm5lbCIsIm9mIiwibWVzc2FnZV9jaGFubmVsIiwib24iLCJjb25zb2xlIiwibG9nIiwiZGF0YSIsImpvaW4iLCJjb252b0lkIiwidG8iLCJlbWl0IiwibWVzc2FnZSIsImxlYXZlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsSUFBTUEsR0FBRyxHQUFHQyxPQUFPLENBQUMsV0FBRCxDQUFuQjs7QUFHQSxJQUFNQyxFQUFFLEdBQUcsSUFBSUYsR0FBSixDQUFRO0FBQ2ZHLEVBQUFBLFdBQVcsRUFBRSxLQURFO0FBRWZDLEVBQUFBLElBQUksRUFBRTtBQUZTLENBQVIsQ0FBWDtBQUtBRixFQUFFLENBQUNHLE9BQUgsQ0FBVyxVQUFDQyxDQUFELEVBQUlDLEVBQUosRUFBVztBQUNsQkEsRUFBQUEsRUFBRSxDQUFDLElBQUQsRUFBTyxJQUFQLENBQUY7QUFDSCxDQUZEO0FBSUFMLEVBQUUsQ0FBQ00sR0FBSCxDQUFPLFVBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFrQjtBQUNyQixNQUFJQyxLQUFLLEdBQUdGLE1BQU0sQ0FBQ0csU0FBUCxDQUFpQkMsS0FBakIsQ0FBdUJGLEtBQW5DOztBQUNBLE1BQUlBLEtBQUosRUFBVztBQUNQRixJQUFBQSxNQUFNLENBQUNFLEtBQVAsR0FBZUEsS0FBZjtBQUNBLFdBQU9ELElBQUksRUFBWDtBQUNIOztBQUNELFNBQU9BLElBQUksQ0FBQyxJQUFJSSxLQUFKLENBQVUsZ0JBQVYsQ0FBRCxDQUFYO0FBQ0gsQ0FQRDtBQVNBLElBQU1DLG9CQUFvQixHQUFHYixFQUFFLENBQUNjLEVBQUgsQ0FBTSxnQkFBTixDQUE3QjtBQUNBLElBQU1DLGVBQWUsR0FBR2YsRUFBRSxDQUFDYyxFQUFILENBQU0sVUFBTixDQUF4QjtBQUVBZCxFQUFFLENBQUNnQixFQUFILENBQU0sWUFBTixFQUFvQixVQUFDVCxNQUFELEVBQVksQ0FDNUI7QUFDSCxDQUZEO0FBSUFRLGVBQWUsQ0FBQ0MsRUFBaEIsQ0FBbUIsWUFBbkIsRUFBaUMsVUFBQ1QsTUFBRCxFQUFZO0FBQ3pDVSxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWVgsTUFBTSxDQUFDRSxLQUFuQixFQUR5QyxDQUd6Qzs7QUFDQUYsRUFBQUEsTUFBTSxDQUFDUyxFQUFQLENBQVUsTUFBVixFQUFrQixVQUFDRyxJQUFELEVBQVU7QUFDeEJaLElBQUFBLE1BQU0sQ0FBQ2EsSUFBUCxDQUFZRCxJQUFJLENBQUNFLE9BQWpCO0FBQ0gsR0FGRCxFQUp5QyxDQVF6Qzs7QUFDQWQsRUFBQUEsTUFBTSxDQUFDUyxFQUFQLENBQVUsU0FBVixFQUFxQixVQUFDRyxJQUFELEVBQVU7QUFDM0I7QUFDQTtBQUNBWixJQUFBQSxNQUFNLENBQUNlLEVBQVAsQ0FBVUgsSUFBSSxDQUFDRSxPQUFmLEVBQXdCRSxJQUF4QixDQUE2QkosSUFBSSxDQUFDSyxPQUFsQztBQUNILEdBSkQsRUFUeUMsQ0FlekM7O0FBQ0FqQixFQUFBQSxNQUFNLENBQUNTLEVBQVAsQ0FBVSxPQUFWLEVBQW1CLFVBQUNHLElBQUQsRUFBVTtBQUN6QlosSUFBQUEsTUFBTSxDQUFDa0IsS0FBUCxDQUFhTixJQUFJLENBQUNFLE9BQWxCO0FBQ0gsR0FGRDtBQUdILENBbkJEO2VBcUJlckIsRSIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNpbyA9IHJlcXVpcmUoJ3NvY2tldC5pbycpXHJcblxyXG5cclxuY29uc3QgaW8gPSBuZXcgc2lvKHtcclxuICAgIHNlcnZlQ2xpZW50OiBmYWxzZSxcclxuICAgIHBhdGg6ICcvc29ja2V0LmlvJ1xyXG59KVxyXG5cclxuaW8ub3JpZ2lucygobywgY2IpID0+IHtcclxuICAgIGNiKG51bGwsIHRydWUpXHJcbn0pXHJcblxyXG5pby51c2UoKHNvY2tldCwgbmV4dCkgPT4ge1xyXG4gICAgbGV0IHRva2VuID0gc29ja2V0LmhhbmRzaGFrZS5xdWVyeS50b2tlblxyXG4gICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgc29ja2V0LnRva2VuID0gdG9rZW5cclxuICAgICAgICByZXR1cm4gbmV4dCgpXHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV4dChuZXcgRXJyb3IoJ0F1dGggbm90IHZhbGlkJykpXHJcbn0pXHJcblxyXG5jb25zdCBub3RpZmljYXRpb25fY2hhbm5lbCA9IGlvLm9mKCcvbm90aWZpY2F0aW9ucycpXHJcbmNvbnN0IG1lc3NhZ2VfY2hhbm5lbCA9IGlvLm9mKCcvbWVzc2FnZScpXHJcblxyXG5pby5vbignY29ubmVjdGlvbicsIChzb2NrZXQpID0+IHtcclxuICAgIC8vdXBkYXRlIHNvY2tldCBpZCB3aXRoIHVzZXJuYW1lIGFuZCBvbmxpbmUgc3RhdHVzXHJcbn0pXHJcblxyXG5tZXNzYWdlX2NoYW5uZWwub24oJ2Nvbm5lY3Rpb24nLCAoc29ja2V0KSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhzb2NrZXQudG9rZW4pXHJcblxyXG4gICAgLy9IYW5kbGUgY29udm8gam9pblxyXG4gICAgc29ja2V0Lm9uKCdqb2luJywgKGRhdGEpID0+IHtcclxuICAgICAgICBzb2NrZXQuam9pbihkYXRhLmNvbnZvSWQpXHJcbiAgICB9KVxyXG5cclxuICAgIC8vSGFuZGxlIG5ldyBtZXNzYWdlXHJcbiAgICBzb2NrZXQub24oJ21lc3NhZ2UnLCAoZGF0YSkgPT4ge1xyXG4gICAgICAgIC8vc2F2ZSBpbiBkYlxyXG4gICAgICAgIC8vZW1pdCB0byBvdGhlciByZWNwc1xyXG4gICAgICAgIHNvY2tldC50byhkYXRhLmNvbnZvSWQpLmVtaXQoZGF0YS5tZXNzYWdlKVxyXG4gICAgfSlcclxuXHJcbiAgICAvL0xlYXZlIGNvbnZlcnNhdGlvblxyXG4gICAgc29ja2V0Lm9uKCdsZWF2ZScsIChkYXRhKSA9PiB7XHJcbiAgICAgICAgc29ja2V0LmxlYXZlKGRhdGEuY29udm9JZClcclxuICAgIH0pXHJcbn0pXHJcblxyXG5leHBvcnQgZGVmYXVsdCBpbyJdfQ==