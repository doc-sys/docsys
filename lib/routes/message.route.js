"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _expressValidator = require("express-validator");

var _authenticate = _interopRequireDefault(require("../lib/helpers/authenticate"));

var _validator = require("../lib/helpers/validator");

var _message = require("../controller/message.controller");

var initiate = _interopRequireWildcard(require("../lib/requestSchemas/message.initiateConvo.json"));

var getHistory = _interopRequireWildcard(require("../lib/requestSchemas/message.getHistory.json"));

var express = require('express');

var router = express.Router();
router.route('/')
/**
 * @api {get} /message/ Get conversations
 * @apiName messagesGetConvos
 * @apiGroup Messages
 * @apiDescription Gets the conversations for a single user. The actual messages are not send.
 * @apiSuccess {Array} conversations All conversations involving the user
 * @apiError (401) {String} AuthentificationError Not allowed to access ressource
 */
.get([_authenticate["default"], _message.getConversations], function (req, res) {
  res.status(200).json(res.locals.conversations);
})
/**
/**
 * @api {post} /message/ Create conversations
 * @apiName messagesCreateConvo
 * @apiGroup Messages
 * @apiDescription Initiates a new conversation.
 * @apiSuccess {String} convoId The conversation id
 * @apiError (401) {String} AuthentificationError Not allowed to access ressource
 */
.post([_authenticate["default"], (0, _expressValidator.checkSchema)(initiate), _validator.checkSchemaValidation, _message.createNewConversation], function (req, res) {
  res.status(200).json(res.locals.conversationId);
});
router.route('/:convoid')
/**
 * @api {get} /message/:convoid Get messages
 * @apiName messagesGetMessages
 * @apiGroup Messages
 * @apiDescription Gets the actual messages of a single conversation
 * @apiSuccess {Array} messages All messages in that conversation already ordered
 * @apiError (401) {String} AuthentificationError Not allowed to access ressource
 */
.get([_authenticate["default"], (0, _expressValidator.checkSchema)(getHistory), _validator.checkSchemaValidation, _message.getConversationHistory], function (req, res) {
  res.status(200).json(res.locals.history);
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yb3V0ZXMvbWVzc2FnZS5yb3V0ZS50cyJdLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInJvdXRlIiwiZ2V0IiwiYXV0aGVudGljYXRlIiwiZ2V0Q29udmVyc2F0aW9ucyIsInJlcSIsInJlcyIsInN0YXR1cyIsImpzb24iLCJsb2NhbHMiLCJjb252ZXJzYXRpb25zIiwicG9zdCIsImluaXRpYXRlIiwiY2hlY2tTY2hlbWFWYWxpZGF0aW9uIiwiY3JlYXRlTmV3Q29udmVyc2F0aW9uIiwiY29udmVyc2F0aW9uSWQiLCJnZXRIaXN0b3J5IiwiZ2V0Q29udmVyc2F0aW9uSGlzdG9yeSIsImhpc3RvcnkiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFFQTs7QUFDQTs7QUFSQSxJQUFJQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFELENBQXJCOztBQVVBLElBQUlDLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFSLEVBQWI7QUFFQUQsTUFBTSxDQUFDRSxLQUFQLENBQWEsR0FBYjtBQUNJOzs7Ozs7OztBQURKLENBU0tDLEdBVEwsQ0FTUyxDQUFDQyx3QkFBRCxFQUFlQyx5QkFBZixDQVRULEVBUzJDLFVBQUNDLEdBQUQsRUFBTUMsR0FBTixFQUFjO0FBQ2pEQSxFQUFBQSxHQUFHLENBQUNDLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQkYsR0FBRyxDQUFDRyxNQUFKLENBQVdDLGFBQWhDO0FBQ0gsQ0FYTDtBQVlJOzs7Ozs7Ozs7QUFaSixDQXFCS0MsSUFyQkwsQ0FxQlUsQ0FBQ1Isd0JBQUQsRUFBZSxtQ0FBWVMsUUFBWixDQUFmLEVBQXNDQyxnQ0FBdEMsRUFBNkRDLDhCQUE3RCxDQXJCVixFQXFCK0YsVUFBQ1QsR0FBRCxFQUFNQyxHQUFOLEVBQWM7QUFDckdBLEVBQUFBLEdBQUcsQ0FBQ0MsTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCRixHQUFHLENBQUNHLE1BQUosQ0FBV00sY0FBaEM7QUFDSCxDQXZCTDtBQXlCQWhCLE1BQU0sQ0FBQ0UsS0FBUCxDQUFhLFdBQWI7QUFDSTs7Ozs7Ozs7QUFESixDQVNLQyxHQVRMLENBU1MsQ0FBQ0Msd0JBQUQsRUFBZSxtQ0FBWWEsVUFBWixDQUFmLEVBQXdDSCxnQ0FBeEMsRUFBK0RJLCtCQUEvRCxDQVRULEVBU2lHLFVBQUNaLEdBQUQsRUFBTUMsR0FBTixFQUFjO0FBQ3ZHQSxFQUFBQSxHQUFHLENBQUNDLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQkYsR0FBRyxDQUFDRyxNQUFKLENBQVdTLE9BQWhDO0FBQ0gsQ0FYTDtBQWFBQyxNQUFNLENBQUNDLE9BQVAsR0FBaUJyQixNQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImxldCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpXHJcbmltcG9ydCB7IGNoZWNrU2NoZW1hIH0gZnJvbSAnZXhwcmVzcy12YWxpZGF0b3InXHJcbmltcG9ydCBhdXRoZW50aWNhdGUgZnJvbSAnLi4vbGliL2hlbHBlcnMvYXV0aGVudGljYXRlJ1xyXG5pbXBvcnQgeyBjaGVja1NjaGVtYVZhbGlkYXRpb24gfSBmcm9tICcuLi9saWIvaGVscGVycy92YWxpZGF0b3InXHJcblxyXG5pbXBvcnQgeyBjcmVhdGVOZXdDb252ZXJzYXRpb24sIGdldENvbnZlcnNhdGlvbnMsIGdldENvbnZlcnNhdGlvbkhpc3RvcnkgfSBmcm9tICcuLi9jb250cm9sbGVyL21lc3NhZ2UuY29udHJvbGxlcic7XHJcblxyXG5pbXBvcnQgKiBhcyBpbml0aWF0ZSBmcm9tICcuLi9saWIvcmVxdWVzdFNjaGVtYXMvbWVzc2FnZS5pbml0aWF0ZUNvbnZvLmpzb24nXHJcbmltcG9ydCAqIGFzIGdldEhpc3RvcnkgZnJvbSAnLi4vbGliL3JlcXVlc3RTY2hlbWFzL21lc3NhZ2UuZ2V0SGlzdG9yeS5qc29uJ1xyXG5cclxubGV0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKClcclxuXHJcbnJvdXRlci5yb3V0ZSgnLycpXHJcbiAgICAvKipcclxuICAgICAqIEBhcGkge2dldH0gL21lc3NhZ2UvIEdldCBjb252ZXJzYXRpb25zXHJcbiAgICAgKiBAYXBpTmFtZSBtZXNzYWdlc0dldENvbnZvc1xyXG4gICAgICogQGFwaUdyb3VwIE1lc3NhZ2VzXHJcbiAgICAgKiBAYXBpRGVzY3JpcHRpb24gR2V0cyB0aGUgY29udmVyc2F0aW9ucyBmb3IgYSBzaW5nbGUgdXNlci4gVGhlIGFjdHVhbCBtZXNzYWdlcyBhcmUgbm90IHNlbmQuXHJcbiAgICAgKiBAYXBpU3VjY2VzcyB7QXJyYXl9IGNvbnZlcnNhdGlvbnMgQWxsIGNvbnZlcnNhdGlvbnMgaW52b2x2aW5nIHRoZSB1c2VyXHJcbiAgICAgKiBAYXBpRXJyb3IgKDQwMSkge1N0cmluZ30gQXV0aGVudGlmaWNhdGlvbkVycm9yIE5vdCBhbGxvd2VkIHRvIGFjY2VzcyByZXNzb3VyY2VcclxuICAgICAqL1xyXG4gICAgLmdldChbYXV0aGVudGljYXRlLCBnZXRDb252ZXJzYXRpb25zXSwgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24ocmVzLmxvY2Fscy5jb252ZXJzYXRpb25zKVxyXG4gICAgfSlcclxuICAgIC8qKlxyXG4gICAgLyoqXHJcbiAgICAgKiBAYXBpIHtwb3N0fSAvbWVzc2FnZS8gQ3JlYXRlIGNvbnZlcnNhdGlvbnNcclxuICAgICAqIEBhcGlOYW1lIG1lc3NhZ2VzQ3JlYXRlQ29udm9cclxuICAgICAqIEBhcGlHcm91cCBNZXNzYWdlc1xyXG4gICAgICogQGFwaURlc2NyaXB0aW9uIEluaXRpYXRlcyBhIG5ldyBjb252ZXJzYXRpb24uXHJcbiAgICAgKiBAYXBpU3VjY2VzcyB7U3RyaW5nfSBjb252b0lkIFRoZSBjb252ZXJzYXRpb24gaWRcclxuICAgICAqIEBhcGlFcnJvciAoNDAxKSB7U3RyaW5nfSBBdXRoZW50aWZpY2F0aW9uRXJyb3IgTm90IGFsbG93ZWQgdG8gYWNjZXNzIHJlc3NvdXJjZVxyXG4gICAgICovXHJcbiAgICAucG9zdChbYXV0aGVudGljYXRlLCBjaGVja1NjaGVtYShpbml0aWF0ZSksIGNoZWNrU2NoZW1hVmFsaWRhdGlvbiwgY3JlYXRlTmV3Q29udmVyc2F0aW9uXSwgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24ocmVzLmxvY2Fscy5jb252ZXJzYXRpb25JZClcclxuICAgIH0pXHJcblxyXG5yb3V0ZXIucm91dGUoJy86Y29udm9pZCcpXHJcbiAgICAvKipcclxuICAgICAqIEBhcGkge2dldH0gL21lc3NhZ2UvOmNvbnZvaWQgR2V0IG1lc3NhZ2VzXHJcbiAgICAgKiBAYXBpTmFtZSBtZXNzYWdlc0dldE1lc3NhZ2VzXHJcbiAgICAgKiBAYXBpR3JvdXAgTWVzc2FnZXNcclxuICAgICAqIEBhcGlEZXNjcmlwdGlvbiBHZXRzIHRoZSBhY3R1YWwgbWVzc2FnZXMgb2YgYSBzaW5nbGUgY29udmVyc2F0aW9uXHJcbiAgICAgKiBAYXBpU3VjY2VzcyB7QXJyYXl9IG1lc3NhZ2VzIEFsbCBtZXNzYWdlcyBpbiB0aGF0IGNvbnZlcnNhdGlvbiBhbHJlYWR5IG9yZGVyZWRcclxuICAgICAqIEBhcGlFcnJvciAoNDAxKSB7U3RyaW5nfSBBdXRoZW50aWZpY2F0aW9uRXJyb3IgTm90IGFsbG93ZWQgdG8gYWNjZXNzIHJlc3NvdXJjZVxyXG4gICAgICovXHJcbiAgICAuZ2V0KFthdXRoZW50aWNhdGUsIGNoZWNrU2NoZW1hKGdldEhpc3RvcnkpLCBjaGVja1NjaGVtYVZhbGlkYXRpb24sIGdldENvbnZlcnNhdGlvbkhpc3RvcnldLCAocmVxLCByZXMpID0+IHtcclxuICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbihyZXMubG9jYWxzLmhpc3RvcnkpXHJcbiAgICB9KVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXIiXX0=